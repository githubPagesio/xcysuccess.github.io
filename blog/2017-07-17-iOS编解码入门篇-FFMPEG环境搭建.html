
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>iOS编解码入门篇(FFMPEG环境搭建) | 向晨宇的技术博客</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="向晨宇">
    

    <meta name="keywords" content="FFmpeg,环境搭建">
    <meta name="description" content="描述FFMPEG环境搭建,接下来将会对iOS上的编解码进行一个持续的篇章介绍">
<meta property="og:type" content="article">
<meta property="og:title" content="iOS编解码入门篇(FFMPEG环境搭建)">
<meta property="og:url" content="http://www.iosxxx.com/blog/2017-07-17-iOS编解码入门篇-FFMPEG环境搭建.html">
<meta property="og:site_name" content="向晨宇的技术博客">
<meta property="og:description" content="描述FFMPEG环境搭建,接下来将会对iOS上的编解码进行一个持续的篇章介绍">
<meta property="og:image" content="http://www.iosxxx.com/../images/ffmpeg/1.png">
<meta property="og:image" content="http://www.iosxxx.com/../images/ffmpeg/2.png">
<meta property="og:image" content="http://www.iosxxx.com/../images/ffmpeg/5.png">
<meta property="og:image" content="http://www.iosxxx.com/../images/ffmpeg/4.png">
<meta property="og:image" content="http://www.iosxxx.com/../images/ffmpeg/3.png">
<meta property="og:image" content="http://www.iosxxx.com/../images/ffmpeg/7.png">
<meta property="og:image" content="http://www.iosxxx.com/../images/ffmpeg/6.png">
<meta property="og:updated_time" content="2017-08-25T03:32:25.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="iOS编解码入门篇(FFMPEG环境搭建)">
<meta name="twitter:description" content="描述FFMPEG环境搭建,接下来将会对iOS上的编解码进行一个持续的篇章介绍">
<meta name="twitter:image" content="http://www.iosxxx.com/../images/ffmpeg/1.png">

    
    <link rel="alternative" href="/atom.xml" title="向晨宇的技术博客" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.png">
    
    
    <link rel="apple-touch-icon" href="/img/favicon.png">
    <link rel="apple-touch-icon-precomposed" href="/img/favicon.png">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="向晨宇的技术博客">向晨宇的技术博客</a></h1>
				<h2 class="blog-motto">做人做事,只有偏执到癫狂,才能达到顶峰</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">主页</a></li>
					
						<li><a href="/archives/">所有文章</a></li>
					
						<li><a href="/index/">索引</a></li>
					
						<li><a href="/about/">关于我</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:www.iosxxx.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/blog/2017-07-17-iOS编解码入门篇-FFMPEG环境搭建.html" title="iOS编解码入门篇(FFMPEG环境搭建)" itemprop="url">iOS编解码入门篇(FFMPEG环境搭建)</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="向晨宇" target="_blank" itemprop="author">向晨宇</a>
		
  <p class="article-time">
    <time datetime="2017-07-17T11:39:32.000Z" itemprop="datePublished"> 发表于 2017-07-17</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#前言"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#一-iOS编解码介绍"><span class="toc-number">2.</span> <span class="toc-text">一.iOS编解码介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-硬编解码和软编解码"><span class="toc-number">2.0.1.</span> <span class="toc-text">1. 硬编解码和软编解码</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#二-Mac上FFmpeg环境搭建"><span class="toc-number">3.</span> <span class="toc-text">二.Mac上FFmpeg环境搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-mac上安装FFmpeg"><span class="toc-number">3.0.1.</span> <span class="toc-text">1. mac上安装FFmpeg</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-常用命令"><span class="toc-number">3.0.2.</span> <span class="toc-text">2. 常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-ffmpeg的常用库"><span class="toc-number">3.0.2.1.</span> <span class="toc-text">1.ffmpeg的常用库</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-主要参数"><span class="toc-number">3.0.2.2.</span> <span class="toc-text">2.主要参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-ffprobe"><span class="toc-number">3.0.2.3.</span> <span class="toc-text">3.ffprobe</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-ffmpeg"><span class="toc-number">3.0.2.4.</span> <span class="toc-text">4.ffmpeg</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-ffplay"><span class="toc-number">3.0.2.5.</span> <span class="toc-text">5.ffplay</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#三-编译支持iOS版本的h264编解码的FFmpeg"><span class="toc-number">4.</span> <span class="toc-text">三.编译支持iOS版本的h264编解码的FFmpeg</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#所需工具如下"><span class="toc-number">4.0.1.</span> <span class="toc-text">所需工具如下</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-找个目录新建一个文件夹h264"><span class="toc-number">4.0.1.1.</span> <span class="toc-text">1.找个目录新建一个文件夹h264</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-下载gas-preprocessor"><span class="toc-number">4.0.1.2.</span> <span class="toc-text">2.下载gas-preprocessor</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-安装yasm"><span class="toc-number">4.0.1.3.</span> <span class="toc-text">3.安装yasm</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-下载x264-iOS编译脚本以及源码"><span class="toc-number">4.0.1.4.</span> <span class="toc-text">4.下载x264-iOS编译脚本以及源码</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-下载FFmpeg-iOS-build-script"><span class="toc-number">4.0.1.5.</span> <span class="toc-text">5.下载FFmpeg-iOS-build-script</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#四-完成xcode的编译"><span class="toc-number">5.</span> <span class="toc-text">四. 完成xcode的编译</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考目录"><span class="toc-number">6.</span> <span class="toc-text">参考目录</span></a></li></ol>
		
		</div>
		
		<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>一直很想做一个长期的专题介绍，既然已经转做直播软件了，对这一块也很有兴趣。接下来会做一些自己在编解码的分享与体会。欢迎大家共同探讨。</p>
<h2 id="一-iOS编解码介绍"><a href="#一-iOS编解码介绍" class="headerlink" title="一.iOS编解码介绍"></a>一.iOS编解码介绍</h2><h4 id="1-硬编解码和软编解码"><a href="#1-硬编解码和软编解码" class="headerlink" title="1. 硬编解码和软编解码"></a>1. 硬编解码和软编解码</h4><p>iOS上编解码分为两种，硬编解码和软编解码。  </p>
<table>
<thead>
<tr>
<th>类型</th>
<th>工具</th>
<th>硬件支持</th>
<th>后台</th>
<th>思路</th>
</tr>
</thead>
<tbody>
<tr>
<td>硬编解码</td>
<td>VideoToolBox</td>
<td>非CPU或者专用处理器</td>
<td>编码(iOS&gt;=10.0),解码不支持</td>
<td>VideoVTToolBox</td>
<td></td>
</tr>
<tr>
<td></td>
<td>AVAssetWriter</td>
<td>非CPU或者专用处理器</td>
<td>支持编码</td>
<td>需要将视频写入本地文件，然后通过实时监听文件内容的改变，读取文件并处理封包</td>
<td></td>
</tr>
<tr>
<td>软编解码</td>
<td>FFmpeg</td>
<td>CPU</td>
<td>支持</td>
<td>————-</td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="二-Mac上FFmpeg环境搭建"><a href="#二-Mac上FFmpeg环境搭建" class="headerlink" title="二.Mac上FFmpeg环境搭建"></a>二.Mac上FFmpeg环境搭建</h2><h4 id="1-mac上安装FFmpeg"><a href="#1-mac上安装FFmpeg" class="headerlink" title="1. mac上安装FFmpeg"></a>1. mac上安装FFmpeg</h4><p>如果已经用brew安装的方式是     </p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install ffmpeg</span><br></pre></td></tr></table></figure>
<p>建议先卸载掉-&gt;<code>brew uninstall ffmpeg</code>,因为上诉安装方法会丢失很多功能。详情可以看官方介绍<br><a href="https://trac.ffmpeg.org/wiki/CompilationGuide/MacOSX" target="_blank" rel="external">wiki:CompilationGuide/MacOSX</a><br>故而用以下命令重新安装     </p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install ffmpeg --with-fdk-aac --with-tools --with-ffplay --with-freetype --with-libass --with-libvorbis --with-opus --with-libvpx --with-x265</span><br></pre></td></tr></table></figure>
<p>安装完可以用命令行查看是否安装成功。   </p>
<p><img src="../images/ffmpeg/1.png" alt="">  </p>
<h4 id="2-常用命令"><a href="#2-常用命令" class="headerlink" title="2. 常用命令"></a>2. 常用命令</h4><h5 id="1-ffmpeg的常用库"><a href="#1-ffmpeg的常用库" class="headerlink" title="1.ffmpeg的常用库"></a>1.ffmpeg的常用库</h5><table>
<thead>
<tr>
<th style="text-align:left">Left Aligned</th>
<th style="text-align:center">Center Aligned</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">ffmpeg</td>
<td style="text-align:center">一个命令行工具，用来对视频文件转换格式，也支持对电视卡即时编码</td>
</tr>
<tr>
<td style="text-align:left">ffserver</td>
<td style="text-align:center">一个HTTP多媒体即时广播流服务器，支持时光平移</td>
</tr>
<tr>
<td style="text-align:left">ffplay</td>
<td style="text-align:center">一个简单的播放器，基于SDL与FFmpeg库</td>
</tr>
<tr>
<td style="text-align:left">libavcodec</td>
<td style="text-align:center">包含全部FFmpeg音频/视频编解码库</td>
</tr>
<tr>
<td style="text-align:left">libavformat</td>
<td style="text-align:center">包含demuxers和muxer库</td>
</tr>
<tr>
<td style="text-align:left">libavutil</td>
<td style="text-align:center">包含一些工具库</td>
</tr>
<tr>
<td style="text-align:left">libpostproc</td>
<td style="text-align:center">对于视频做前处理的库</td>
</tr>
<tr>
<td style="text-align:left">libavutil</td>
<td style="text-align:center">包含一些工具库</td>
</tr>
<tr>
<td style="text-align:left">libswscale</td>
<td style="text-align:center">对于视频作缩放的库</td>
</tr>
</tbody>
</table>
<h5 id="2-主要参数"><a href="#2-主要参数" class="headerlink" title="2.主要参数"></a>2.主要参数</h5><p>参数明细可用<code>ffmpeg -h</code>显示；编解码器名称等明细可用<code>ffmpeg -formats</code>显示.   </p>
<table>
<thead>
<tr>
<th style="text-align:left">主要参数</th>
<th style="text-align:center">意义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">-i</td>
<td style="text-align:center">设置输入档名。</td>
</tr>
<tr>
<td style="text-align:left">-f</td>
<td style="text-align:center">设置输出格式。</td>
</tr>
<tr>
<td style="text-align:left">-y</td>
<td style="text-align:center">若输出文件已存在时则覆盖文件。</td>
</tr>
<tr>
<td style="text-align:left">-fs</td>
<td style="text-align:center">超过指定的文件大小时则结束转换。</td>
</tr>
<tr>
<td style="text-align:left">-ss</td>
<td style="text-align:center">从指定时间开始转换。</td>
</tr>
<tr>
<td style="text-align:left">-t</td>
<td style="text-align:center">从-ss时间开始转换（如-ss 00:00:01.00 -t 00:00:10.00即从00:00:01.00开始到00:00:11.00）。</td>
</tr>
<tr>
<td style="text-align:left">-title</td>
<td style="text-align:center">设置标题。</td>
</tr>
<tr>
<td style="text-align:left">-timestamp</td>
<td style="text-align:center">设置时间戳。</td>
</tr>
<tr>
<td style="text-align:left">-vsync</td>
<td style="text-align:center">增减Frame使影音同步。</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:left">视频参数</th>
<th style="text-align:center">意义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">b:v</td>
<td style="text-align:center">设置视频流量，默认为200Kbit/秒。（单位请引用下方注意事项）</td>
</tr>
<tr>
<td style="text-align:left">r</td>
<td style="text-align:center">设置帧率值，默认为25。</td>
</tr>
<tr>
<td style="text-align:left">s</td>
<td style="text-align:center">设置画面的宽与高。</td>
</tr>
<tr>
<td style="text-align:left">aspect</td>
<td style="text-align:center">设置画面的比例。</td>
</tr>
<tr>
<td style="text-align:left">vn</td>
<td style="text-align:center">不处理视频，于仅针对声音做处理时使用。</td>
</tr>
<tr>
<td style="text-align:left">vcodec( -c:v )</td>
<td style="text-align:center">设置视频视频编解码器，未设置时则使用与输入文件相同之编解码器。</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:left">声音参数</th>
<th style="text-align:center">意义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">b:a</td>
<td style="text-align:center">设置每Channel（最近的SVN版为所有Channel的总合）的流量。（单位请引用下方注意事项）</td>
</tr>
<tr>
<td style="text-align:left">ar</td>
<td style="text-align:center">设置采样率。</td>
</tr>
<tr>
<td style="text-align:left">ac</td>
<td style="text-align:center">设置声音的Channel数。</td>
</tr>
<tr>
<td style="text-align:left">acodec ( -c:a )</td>
<td style="text-align:center">设置声音编解码器，未设置时与视频相同，使用与输入文件相同之编解码器。</td>
</tr>
<tr>
<td style="text-align:left">an</td>
<td style="text-align:center">不处理声音，于仅针对视频做处理时使用。</td>
</tr>
<tr>
<td style="text-align:left">vol</td>
<td style="text-align:center">设置音量大小，256为标准音量。（要设置成两倍音量时则输入512，依此类推。）</td>
</tr>
</tbody>
</table>
<h5 id="3-ffprobe"><a href="#3-ffprobe" class="headerlink" title="3.ffprobe"></a>3.ffprobe</h5><p><a href="http://ffmpeg.org/ffprobe.html" target="_blank" rel="external">官方文档ffprobe</a>.  </p>
<p>一般我自己看一个编码后的文件是否正确就用以下命令，如果格式错误的话会输出一堆Error。   </p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffprobe -show_frames /Users/tomxiang/Desktop/h265/test_tomxiang.h265</span><br></pre></td></tr></table></figure>
<p>如果想看<strong>JSON</strong>格式的话可以用        </p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffprobe -print_format json -show_format -show_streams -i /Users/tomxiang/Desktop/h265/test_tomxiang.h265</span><br></pre></td></tr></table></figure>
<p>可以看到如图所示:    </p>
<p><img src="../images/ffmpeg/2.png" alt="">  </p>
<h5 id="4-ffmpeg"><a href="#4-ffmpeg" class="headerlink" title="4.ffmpeg"></a>4.ffmpeg</h5><p><a href="http://ffmpeg.org/ffmpeg.html" target="_blank" rel="external">官方文档ffmpeg</a>.  </p>
<p>查看h265的数据的基本信息   </p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i /Users/tomxiang/Desktop/h265/test_tomxiang.h265</span><br></pre></td></tr></table></figure>
<p>用libx265转mp4.   </p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i /Users/tomxiang/Desktop/test_tomxiang.h265  -c:v libx265 /Users/tomxiang/xxtest/test265.mp4</span><br></pre></td></tr></table></figure>
<h5 id="5-ffplay"><a href="#5-ffplay" class="headerlink" title="5.ffplay"></a>5.ffplay</h5><p>ffplay逐帧播放视频与显示视频帧序号</p>
<p>目前使用这个功能检查部分画面不正确视频的原因。macOS下使用ffplay，按下s键可单帧播放视频，配合一个显示文字的视频滤镜即可显示当前画面的帧序号，命令示例如下所示。   </p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffplay -vf <span class="string">"drawtext=fontfile=/Library/Fonts/Arial.ttf:text=%&#123;n&#125;:box=1:x=(w-tw)/2:y=h-(2*lh)"</span> sample.mp4</span><br></pre></td></tr></table></figure>
<h2 id="三-编译支持iOS版本的h264编解码的FFmpeg"><a href="#三-编译支持iOS版本的h264编解码的FFmpeg" class="headerlink" title="三.编译支持iOS版本的h264编解码的FFmpeg"></a>三.编译支持iOS版本的h264编解码的FFmpeg</h2><h4 id="所需工具如下"><a href="#所需工具如下" class="headerlink" title="所需工具如下"></a>所需工具如下</h4><p>1、<a href="https://github.com/libav/gas-preprocessor" target="_blank" rel="external">gas-preprocessor</a><br>2、<a href="https://github.com/yasm/yasm" target="_blank" rel="external">yasm</a><br>3、<a href="https://github.com/kewlbear/FFmpeg-iOS-build-script" target="_blank" rel="external">FFmpeg-iOS-build-script</a>    </p>
<h5 id="1-找个目录新建一个文件夹h264"><a href="#1-找个目录新建一个文件夹h264" class="headerlink" title="1.找个目录新建一个文件夹h264"></a>1.找个目录新建一个文件夹h264</h5><h5 id="2-下载gas-preprocessor"><a href="#2-下载gas-preprocessor" class="headerlink" title="2.下载gas-preprocessor"></a>2.下载<a href="https://github.com/libav/gas-preprocessor" target="_blank" rel="external">gas-preprocessor</a></h5><p>它是编译 FFmpeg 的所需脚本文件,然后需要将其拷贝斤bin文件夹，使用命令</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp -f /Users/tomxiang/h264/gas-preprocessor-master/gas-preprocessor.pl /usr/local/bin/</span><br></pre></td></tr></table></figure>
<p>完了之后可以进/usr/local/bin/里面查看是否有这个文件。  </p>
<h5 id="3-安装yasm"><a href="#3-安装yasm" class="headerlink" title="3.安装yasm"></a>3.安装<a href="https://github.com/yasm/yasm" target="_blank" rel="external">yasm</a></h5><p>Yasm是一个完全重写的 NASM 汇编。目前，它支持x86和AMD64指令集，接受NASM和气体汇编语法，<br>产出二进制，ELF32 ， ELF64 ， COFF ， Mach - O的（ 32和64 ），RDOFF2 ，的Win32和Win64对象的格式，<br>并生成STABS 调试信息的来源，DWARF 2 ，CodeView 8格式。    </p>
<p>安装命令</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install yasm</span><br></pre></td></tr></table></figure>
<p>如果安装失败可以直接下载安装   </p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">curl http:<span class="comment">//www.tortall.net/projects/yasm/releases/yasm-1.2.0.tar.gz &gt;yasm.tar.gz</span></span><br><span class="line">tar xzvf yasm.tar.gz</span><br><span class="line">cd yasm<span class="number">-1.2</span><span class="number">.0</span></span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure>
<h5 id="4-下载x264-iOS编译脚本以及源码"><a href="#4-下载x264-iOS编译脚本以及源码" class="headerlink" title="4.下载x264-iOS编译脚本以及源码"></a>4.下载<a href="https://github.com/kewlbear/x264-ios" target="_blank" rel="external">x264-iOS编译脚本</a>以及<a href="http://download.videolan.org/pub/videolan/x264/snapshots/" target="_blank" rel="external">源码</a></h5><p>下载编译脚本，然后下载最新版源码,下载完后改名成x264放到x264-ios-master文件夹中。为什么要改名呢？看看编译脚本就自然清楚了，编译脚本中是当前目录的x264文件。<br>然后执行命令:    </p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./build-x264.sh</span><br></pre></td></tr></table></figure>
<p>执行完成之后可以看到生成了x264-iOS文件夹。</p>
<p><img src="../images/ffmpeg/5.png" alt="">  </p>
<h5 id="5-下载FFmpeg-iOS-build-script"><a href="#5-下载FFmpeg-iOS-build-script" class="headerlink" title="5.下载FFmpeg-iOS-build-script"></a>5.下载<a href="https://github.com/kewlbear/FFmpeg-iOS-build-script" target="_blank" rel="external">FFmpeg-iOS-build-script</a></h5><p>查看并修改脚本内容。  </p>
<p><img src="../images/ffmpeg/4.png" alt="">   </p>
<p>并将  </p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>	<span class="built_in">CFLAGS</span>=<span class="string">"$CFLAGS -mios-version-min=$DEPLOYMENT_TARGET -fembed-bitcode"</span></span><br><span class="line">修改为</span><br><span class="line"><span class="number">1</span>	<span class="built_in">CFLAGS</span>=<span class="string">"$CFLAGS -mios-version-min=$DEPLOYMENT_TARGET"</span></span><br></pre></td></tr></table></figure>
<p>如果所示，x264必须在当前目录并且命令为fat-x264,所以我们第4步生成的x264-iOS文件夹改名成fat-264，放在FFmpeg-iOS-build-script这个文件夹中。目录结构如下:    </p>
<p><img src="../images/ffmpeg/3.png" alt="">  </p>
<h2 id="四-完成xcode的编译"><a href="#四-完成xcode的编译" class="headerlink" title="四. 完成xcode的编译"></a>四. 完成xcode的编译</h2><p>本来以为拖进.h和.a然后配置好.就能跑成功了。还是有一点问题的。具体可以参考我图片的配置. 然后修改一个.m文件为.mm编译一把再改回来。OK，大功告成！   </p>
<p><img src="../images/ffmpeg/7.png" alt="">   <img src="../images/ffmpeg/6.png" alt="">  </p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Header Search Paths:</span><br><span class="line">$(PROJECT_DIR)/XXFFmpeg/FFmpeg-iOS/include</span><br><span class="line">$(PROJECT_DIR)/XXAudioVideo/Class/FFmpeg/x264-iOS/include</span><br><span class="line"></span><br><span class="line">Library Search Paths:</span><br><span class="line">$(PROJECT_DIR)/XXFFmpeg/FFmpeg-iOS/lib</span><br><span class="line">$(PROJECT_DIR)/XXAudioVideo/Class/FFmpeg/x264-iOS/lib</span><br></pre></td></tr></table></figure>
<p>测试代码如下:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"XXFFmpegViewController.h"</span></span></span><br><span class="line"><span class="meta">#ifdef __cplusplus</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span> &#123;</span><br><span class="line"><span class="meta">#endif</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">#include <span class="meta-string">"libavutil/opt.h"</span></span></span><br><span class="line"><span class="meta">#include <span class="meta-string">"libavcodec/avcodec.h"</span></span></span><br><span class="line"><span class="meta">#include <span class="meta-string">"libavformat/avformat.h"</span></span></span><br><span class="line"><span class="meta">#include <span class="meta-string">"libswscale/swscale.h"</span></span></span><br><span class="line">    </span><br><span class="line"><span class="meta">#ifdef __cplusplus</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="meta">#endif</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">XXFFmpegViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">XXFFmpegViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    av_register_all();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="参考目录"><a href="#参考目录" class="headerlink" title="参考目录"></a>参考目录</h2><ol>
<li><a href="http://blog.sina.com.cn/s/blog_47522f7f0102vcbj.html" target="_blank" rel="external">iOS开发 编译libx264和带libx264的FFMpeg包</a>   </li>
<li><a href="http://depthlove.github.io/2015/09/18/use-ffmpeg-and-x264-encode-iOS-camera-video-to-h264/" target="_blank" rel="external">利用FFmpeg+x264将iOS摄像头实时视频流编码为h264文件</a>   </li>
<li><a href="https://zh.wikipedia.org/wiki/FFmpeg" target="_blank" rel="external">FFmpeg</a></li>
</ol>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/iOS/">iOS</a>
</div>


</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://www.iosxxx.com/blog/2017-07-17-iOS编解码入门篇-FFMPEG环境搭建.html" data-title="iOS编解码入门篇(FFMPEG环境搭建) | 向晨宇的技术博客" data-tsina="null" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/blog/2017-07-29-FFmpeg3的iOS版的入门格式转换器(无编码).html" title="FFmpeg3的iOS版的入门格式转换器(无编码)">
  <strong>上一篇：</strong><br/>
  <span>
  FFmpeg3的iOS版的入门格式转换器(无编码)</span>
</a>
</div>


<div class="next">
<a href="/blog/2017-03-27-iOS的nstimer与kvo的自释放.html"  title="iOS的NSTimer与KVO的自释放">
 <strong>下一篇：</strong><br/> 
 <span>iOS的NSTimer与KVO的自释放
</span>
</a>
</div>

</nav>

	

<section id="comments" class="comment">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
 
 <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#前言"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#一-iOS编解码介绍"><span class="toc-number">2.</span> <span class="toc-text">一.iOS编解码介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-硬编解码和软编解码"><span class="toc-number">2.0.1.</span> <span class="toc-text">1. 硬编解码和软编解码</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#二-Mac上FFmpeg环境搭建"><span class="toc-number">3.</span> <span class="toc-text">二.Mac上FFmpeg环境搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-mac上安装FFmpeg"><span class="toc-number">3.0.1.</span> <span class="toc-text">1. mac上安装FFmpeg</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-常用命令"><span class="toc-number">3.0.2.</span> <span class="toc-text">2. 常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-ffmpeg的常用库"><span class="toc-number">3.0.2.1.</span> <span class="toc-text">1.ffmpeg的常用库</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-主要参数"><span class="toc-number">3.0.2.2.</span> <span class="toc-text">2.主要参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-ffprobe"><span class="toc-number">3.0.2.3.</span> <span class="toc-text">3.ffprobe</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-ffmpeg"><span class="toc-number">3.0.2.4.</span> <span class="toc-text">4.ffmpeg</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-ffplay"><span class="toc-number">3.0.2.5.</span> <span class="toc-text">5.ffplay</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#三-编译支持iOS版本的h264编解码的FFmpeg"><span class="toc-number">4.</span> <span class="toc-text">三.编译支持iOS版本的h264编解码的FFmpeg</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#所需工具如下"><span class="toc-number">4.0.1.</span> <span class="toc-text">所需工具如下</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-找个目录新建一个文件夹h264"><span class="toc-number">4.0.1.1.</span> <span class="toc-text">1.找个目录新建一个文件夹h264</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-下载gas-preprocessor"><span class="toc-number">4.0.1.2.</span> <span class="toc-text">2.下载gas-preprocessor</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-安装yasm"><span class="toc-number">4.0.1.3.</span> <span class="toc-text">3.安装yasm</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-下载x264-iOS编译脚本以及源码"><span class="toc-number">4.0.1.4.</span> <span class="toc-text">4.下载x264-iOS编译脚本以及源码</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-下载FFmpeg-iOS-build-script"><span class="toc-number">4.0.1.5.</span> <span class="toc-text">5.下载FFmpeg-iOS-build-script</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#四-完成xcode的编译"><span class="toc-number">5.</span> <span class="toc-text">四. 完成xcode的编译</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考目录"><span class="toc-number">6.</span> <span class="toc-text">参考目录</span></a></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="github-card">
<p class="asidetitle">Github 名片</p>
<div class="github-card" data-github="xcysuccess" data-width="220" data-height="119" data-theme="medium">
<script type="text/javascript" src="//cdn.jsdelivr.net/github-cards/latest/widget.js" ></script>
</div>
  </div>



  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
		  
			<li><a href="/categories/iOS/" title="iOS">iOS<sup>22</sup></a></li>
		  
		
		  
			<li><a href="/categories/other/" title="other">other<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/python/" title="python">python<sup>1</sup></a></li>
		  
		
		</ul>
</div>


  

  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="http://blog.sunnyxx.com/" target="_blank" title="sunnyxx">sunnyxx</a>
            
          </li>
        
          <li>
            
            	<a href="http://www.devtang.com/" target="_blank" title="唐巧大神">唐巧大神</a>
            
          </li>
        
          <li>
            
            	<a href="http://beyondvincent.com/" target="_blank" title="破船之家">破船之家</a>
            
          </li>
        
          <li>
            
            	<a href="http://objccn.io/" target="_blank" title="objc中国">objc中国</a>
            
          </li>
        
          <li>
            
            	<a href="http://luodichen.com/blog/" target="_blank" title="luodichen">luodichen</a>
            
          </li>
        
          <li>
            
            	<a href="http://luoyibu.com/" target="_blank" title="luoyibu">luoyibu</a>
            
          </li>
        
    </ul>
</div>

  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> 古之成大事者，不惟有超世之才，亦必有坚韧不拔之志 <br/>
			</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/xcysuccess" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		<a href="https://github.com/xcysuccess" target="_blank" class="icon-github" title="github"></a>
		
		
		
		
		
		
		
		
		
		<a href="mailto:xcysuccess@qq.com" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2017 
		
		<a href="/about" target="_blank" title="向晨宇">向晨宇</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>




<script type="text/javascript">

var disqus_shortname = 'iosxxx';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>






<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
